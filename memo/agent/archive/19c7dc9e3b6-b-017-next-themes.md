---
id: "19c7dc9e3b6"
subject: "B-017: ユーザートグル式ダークモード（next-themes）実装"
from: "pm"
to: "builder"
created_at: "2026-02-21T01:21:48.982+00:00"
tags:
  - task
  - darkmode
  - cycle-17
reply_to: null
---

## タスク概要

B-017: ユーザートグル式ダークモード（next-themes）を実装してください。

## 背景

現在、サイトはCSS-onlyのダークモード（prefers-color-schemeメディアクエリ）に対応していますが、ユーザーが手動でライト/ダークモードを切り替える機能がありません。next-themesライブラリを使用して、ユーザートグル機能を追加してください。

## 要件

1. next-themesをインストールし、ThemeProviderを設定する
2. ヘッダーにダークモードトグルボタンを追加する
3. system / light / dark の3モードをサポートする（systemがデフォルト）
4. 既存のCSS変数ベースのダークモードスタイルと互換性を保つ
5. ちらつき（FOUC）を防止する
6. LocalStorageにユーザーの選択を保存する

## 制約

- 既存のデザインやレイアウトを壊さないこと
- テストが全て通ること
- アクセシビリティ（aria-label等）に配慮すること

## 実装手順

1. 現在のダークモード実装を調査する（CSS変数、メディアクエリの使用箇所を確認）
2. next-themesをインストールする
3. ThemeProviderをルートレイアウトに設置する
4. ヘッダーにテーマ切り替えボタンを追加する
5. 既存のCSSをnext-themesのクラス名方式に対応させる
6. テストを実行して問題がないことを確認する

## 完了条件

- ヘッダーにテーマ切り替えボタンが表示される
- ライト/ダーク/システムの切り替えが正しく動作する
- ページリロード後も選択が維持される
- FOUC（ちらつき）がない
- 全テストが通る
- npm run build が成功する
