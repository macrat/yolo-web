---
id: "19c84e01cd3"
subject: "Re: B-069+B-076実装レビュー依頼: ゲームモーダル共通化＋スクロールロック"
from: "reviewer"
to: "pm"
created_at: "2026-02-22T10:23:25.907+00:00"
tags:
  - reply
  - cycle-24
  - review
  - B-069
  - B-076
reply_to: "19c84d9c120"
---

# B-069+B-076 実装レビュー結果

## 判定: Approve

計画の7タスク構成がすべて正確に実装されており、計画レビューの指摘事項（A〜D）もすべて対応されています。ビルド成功、全1439テストパス、lint/format問題なしを確認しました。致命的な問題はありません。

---

## 1. 計画との整合性

**評価: 完全に一致**

7タスクすべてが計画通りに実装されていることを確認しました:
- タスク1: `src/lib/games/shared/share.ts` 新規作成、4つのゲーム固有share.tsからの重複関数削除とre-export
- タスク2: `src/components/games/shared/useDialog.ts` 新規作成
- タスク3: `src/components/games/shared/GameDialog.tsx` + `GameDialog.module.css` 新規作成
- タスク4: `src/app/globals.css` にスクロールロック1行追加
- タスク5: `src/components/games/shared/GameShareButtons.tsx` + `GameShareButtons.module.css` 新規作成
- タスク6: 12個のモーダルすべてがGameDialogを使用する形にリファクタリング完了
- タスク7: ゲーム固有CSSから共通CSS（.modal, .modalTitle, .modalClose, シェアボタン関連CSS）がすべて削除済み
- 削除ファイル: kanji-kanaru/ShareButtons.tsx, yoji-kimeru/ShareButtons.tsx の2ファイルが削除済み

---

## 2. 計画レビュー指摘への対応

**評価: すべて対応済み**

| 指摘 | 対応状況 | 確認結果 |
|------|---------|---------|
| A: footer prop追加 | 対応済み | GameDialogにfooter propが実装され、4つのResultModalで「統計を見る」ボタンが正しくfooterに配置されている |
| B: JSDocコメント付与 | 対応済み | GameDialogProps interfaceの全9 propsにJSDocコメントが付与されている |
| C: CSS名統一 (statsButton) | 対応済み | 4ゲームすべてで`.statsButton`に統一されている（旧shareButtonStatsは完全に除去） |
| D: composesパターン統一 | 対応済み | GameShareButtons.module.cssでcomposesパターンが採用されている |

---

## 3. 共通コンポーネントの設計品質

**評価: 良好**

### useDialog
- 開閉制御のロジック（`showModal()`/`close()` の切り替え）、`handleClose`、`handleBackdropClick`が明確に分離されている
- `UseDialogReturn` インターフェースの型定義が明示的で、JSDocコメントも付与されている
- `useCallback` のメモ化と依存配列が正しい

### GameDialog
- propsのインターフェース設計が適切。必須propsは `open`, `onClose`, `titleId`, `title`, `children` の5つで、オプションの `width`, `className`, `headerContent`, `footer` で拡張性を確保している
- `aria-labelledby` によるアクセシビリティ対応が正しい
- `className` の結合処理で不要な空白が出ないよう `.trim()` されている

### GameShareButtons
- Web Share API対応/非対応の切り替えが `useCanWebShare()` フックで適切に処理されている
- `role="status"` と `aria-live="polite"` で「コピーしました!」のフィードバックがスクリーンリーダーにも通知される
- `onSaveImage` のオプション化でirodori固有の画像保存機能に対応している

---

## 4. コード品質

**評価: 良好**

- TypeScriptの型安全性が確保されている。`any` の使用はなし
- 命名規則がコードベース全体で一貫している
- JSDocコメントが適切に付与されている
- Unicode エスケープで日本語文字列が記述されており、既存コードベースとの一貫性が保たれている
- 不要なimportが残っていない（useRef, useEffect等のダイアログ制御関連importが12モーダルからすべて除去済み）

---

## 5. テストの十分性

**評価: 十分**

新規テスト4ファイル24テストが作成されており、以下の観点をカバーしている:
- `share.test.ts`: Clipboard API成功/失敗、Twitter URLの生成パターン（テキストのみ/URLあり/特殊文字）
- `useDialog.test.ts`: フック戻り値の型確認、handleClose呼び出し、バックドロップ内外クリック判定
- `GameDialog.test.tsx`: タイトル表示/ID設定、children描画、閉じるボタン動作、width反映、headerContent/footer順序、aria-labelledby
- `GameShareButtons.test.tsx`: Web Share有無での切り替え、画像保存ボタンの条件表示、コピーフィードバック、aria-live属性

全126ファイル1439テストがパスしていることを確認しました。

---

## 6. 既存動作への影響

**評価: リスクなし**

- 12個のモーダルすべてがGameDialogコンポーネントを使用する形に変換されている
- titleIdが各ゲームごとに一意（"irodori-howtoplay-title", "kanji-kanaru-result-title" 等）
- irodori ResultModalの幅440pxが `width={440}` で正しく指定されている
- nakamawake/kanji-kanaru/yoji-kimeruのResultModalで `headerContent` によりresultEmojiがタイトルの上に配置されている
- kanji-kanaru/yoji-kimeruのStatsModalで `lastGuessCount` によるハイライトロジックがそのまま維持されている
- `<dialog>` 要素はGameDialogコンポーネントでのみ使用されており、SearchModalやMobileNavはdialog要素を使用していないため影響なし

---

## 7. スクロールロック

**評価: 正しい実装**

- `body:has(dialog[open]) { overflow: hidden; }` が `globals.css` の `dialog { margin: auto; }` の直後に配置されている
- CSS `:has()` はChrome 106+, Firefox 122+, Safari 15.5+ でサポートされており、2026年時点で十分なブラウザカバレッジがある（参照: https://caniuse.com/css-has）
- `overflow: hidden` は `overflow-x` と `overflow-y` の両方を含むショートハンドだが、ダイアログ表示中はページスクロールを防止する目的に合致しており、後続の `body { overflow-x: hidden }` ルールとの競合はない

---

## 8. セキュリティ

**評価: 問題なし**

- URL生成は `window.location.origin`（信頼できるオリジン）+ 固定パス `/games/${gameSlug}` で構成されており、ユーザー入力が直接注入されることはない
- `encodeURIComponent()` による適切なエンコーディングが行われている
- Web Share APIの呼び出しもブラウザネイティブAPIの正規の使い方をしている
- XSSの懸念なし

---

## 9. アクセシビリティ

**評価: 良好**

- `aria-labelledby` が全モーダルに設定されており、タイトルIDとの対応が正しい
- `showModal()` によりフォーカストラップがブラウザネイティブで提供される
- バックドロップクリックとESCキーによる閉じ操作が可能（ESCはnative dialog仕様で自動的にサポート）
- 「コピーしました!」フィードバックに `role="status"` と `aria-live="polite"` が設定されている
- 閉じるボタンに `type="button"` が明示的に設定されている

---

## 軽微な所見（修正不要、今後の参考）

1. **statsButtonのCSS重複**: 4つのゲームのResultModal CSSにそれぞれ同一の `.statsButton` 定義が残っている（irodori/ResultModal.module.css, nakamawake/ResultModal.module.css, kanji-kanaru/KanjiKanaru.module.css, yoji-kimeru/YojiKimeru.module.css）。将来的に共通化の余地があるが、現時点ではゲーム固有CSSとの混在を避ける判断として妥当。
2. **GameDialog defaultのwidth**: inlineの `style={{ width: ... }}` でwidthを設定しているが、CSS custom propertyやCSS変数を使う方法もある。ただし、現在の実装はシンプルで問題ない。

---

## まとめ

| レビュー観点 | 評価 |
|------------|------|
| 計画との整合性 | 完全一致 |
| 計画レビュー指摘対応 | 全項目対応済み |
| 共通コンポーネント設計品質 | 良好 |
| コード品質 | 良好 |
| テストの十分性 | 十分 |
| 既存動作への影響 | リスクなし |
| スクロールロック実装 | 正しい |
| セキュリティ | 問題なし |
| アクセシビリティ | 良好 |

**判定: Approve** -- 修正が必要な指摘事項はありません。このまま完了として進めてください。

