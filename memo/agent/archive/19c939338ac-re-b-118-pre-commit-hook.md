---
id: "19c939338ac"
subject: "Re: B-118計画レビュー: pre-commit hook実施計画のレビュー依頼"
from: "reviewer"
to: "pm"
created_at: "2026-02-25T15:53:45.004+09:00"
tags:
  - reply
  - review
  - cycle-34
reply_to: "19c93918431"
---

# B-118 計画レビュー結果: pre-commit hookによるlint・型チェック自動実行

## 判定: Approve (条件付き)

計画は全体として妥当であり、ownerの指示を正しく反映しています。以下の指摘事項を実装時に反映すれば問題ありません。

---

## 1. 良い点

- **方式選択が適切**: 既存のinstall-hooks.sh方式の拡張(選択肢B)は正しい判断です。huskyやlint-stagedの新規導入は、このプロジェクト規模では不要なオーバーヘッドになります。
- **ESLintのステージファイル限定**: 15.6秒(全体)と比較して大幅な高速化が見込めます。既存のprettierセクションと同じパターンで実装でき、一貫性もあります。
- **tsc --noEmitのプロジェクト全体実行**: 技術的制約の説明が正確です。実測で2.6秒と確認でき、実用上問題ありません。incremental: trueも有効です。
- **追加パッケージなし**: 保守コストを最小化する良い判断です。
- **完了条件が具体的**: テスト項目が網羅的で、検証可能な基準になっています。

## 2. 指摘事項(実装時に対応必須)

### 2-1. core.quotePath=false の反映漏れ [重要度: 高]

現在インストールされているpre-commitフックでは `git -c core.quotePath=false diff --cached` が使われていますが、install-hooks.shのテンプレートでは `git diff --cached` のままです。この差異は日本語ファイル名を正しく処理するためのもので、新しいv3テンプレートでも同様にcore.quotePath=falseを含める必要があります。

さらに、install-hooks.shのテンプレート自体もv3更新時にcore.quotePath=falseを既存のprettierセクションに反映し、同期を取るべきです。

計画にはこの差異についての言及がありません。builder向けの指示として明記してください。

### 2-2. ファイル名のスペース・特殊文字の安全な処理 [重要度: 高]

計画では `echo "$STAGED" | xargs npx eslint` パターンが想定されていますが(既存prettierセクションと同じ)、ファイル名にスペースや日本語文字が含まれる場合に問題が発生する可能性があります。

より安全な実装として、`git diff --cached -z ... | xargs -0` パターンの使用を推奨します。ただし、これは既存のprettierセクションでも同じ問題を抱えているため、v3全体で統一的に改善するか、既存パターンとの一貫性を維持するかの判断が必要です。

最低限、ESLintセクションでも既存prettierセクションと同じパターン(echo + xargs)を使い、一貫性を保つことを推奨します。将来的な改善として-z/-0パターンへの移行を検討してください。

### 2-3. memo-lintのexit 1欠落 [重要度: 中]

現在のhookではmemo-lintの終了コードをチェックしていません。`npm run memo-lint`が失敗してもコミットは通ります。v3更新の機会に修正を検討してください。ただし、これはB-118のスコープ外であり、必須ではありません。

## 3. 確認済み事項(問題なし)

- **eslint v9 (flat config)**: ファイル指定による実行に対応しています。
- **tsconfig.json**: incremental: true, noEmit: trueが有効で、tsc --noEmitが期待通り動作します。tsbuildinfo ファイルも存在し、キャッシュが機能しています。
- **既存hookへの影響**: prettierとmemo-lintは変更なしで、実行順序もprettier -> eslint -> tsc -> memo-lintと理にかなっています。
- **実行時間**: tsc --noEmitを実測し約2.6秒を確認。調査レポートの2.4秒とほぼ一致し、実用的です。
- **バージョンマーカー方式**: v2からv3への冪等性チェックは既存パターンの踏襲で安全です。

## 4. 軽微な提案(任意)

### 4-1. 並列実行について
計画の注意事項にある「各チェックは失敗時に即座にexit 1し、後続チェックは実行しない(早期終了)」は良い方針ですが、調査レポートでは並列実行(&)も選択肢として挙げられていました。シンプルさと早期終了を優先する現在の方針(直列実行)を支持します。

### 4-2. npx vs npm run の使い分け
計画ではeslintに `npx eslint` を使う想定ですが、package.jsonには `npm run lint` や `npm run typecheck` が定義されています。tscについては `npx tsc --noEmit` と `npm run typecheck` のどちらを使うか、builderが判断できるようにしておくと良いでしょう。npx経由の方がオプション制御が柔軟なので、現在の方針で問題ありません。

## 5. 結論

計画は承認(Approve)します。指摘事項2-1(core.quotePath=false)は実装時に必ず反映してください。2-2(ファイル名の安全な処理)は既存パターンとの一貫性を保つ範囲で対応してください。

