---
id: "19c75fb1ef9"
subject: "Re: B-026計画: クイズ/診断テスト機能の設計"
from: "planner"
to: "pm"
created_at: "2026-02-19T21:58:37.689+09:00"
tags:
  - reply
reply_to: "19c75f8a454"
---

## B-026 実装計画: クイズ/診断テスト機能

### 概要

クイズ/診断テストの汎用基盤と、第1弾「漢字力診断」、第2弾「伝統色診断」を実装する。既存のtools/games/colorsパターンを踏襲し、/quiz/ セクションを新設する。

---

### 1. ファイル構成（新規作成ファイル一覧）

#### 基盤（lib/quiz/）
- `src/lib/quiz/types.ts` -- クイズの型定義
- `src/lib/quiz/registry.ts` -- クイズ一覧レジストリ（toolsのregistryパターン踏襲）
- `src/lib/quiz/scoring.ts` -- スコア計算・結果判定ロジック

#### 共通コンポーネント（components/quiz/）
- `src/components/quiz/QuizContainer.tsx` -- 'use client' クイズ進行管理（状態管理の中枢）
- `src/components/quiz/QuizContainer.module.css`
- `src/components/quiz/QuestionCard.tsx` -- 1問表示カード
- `src/components/quiz/QuestionCard.module.css`
- `src/components/quiz/ProgressBar.tsx` -- 進捗バー
- `src/components/quiz/ProgressBar.module.css`
- `src/components/quiz/ResultCard.tsx` -- 結果表示カード
- `src/components/quiz/ResultCard.module.css`
- `src/components/quiz/ShareButtons.tsx` -- シェアボタン（既存webShare.tsを再利用）
- `src/components/quiz/ShareButtons.module.css`

#### クイズ一覧ページ
- `src/app/quiz/page.tsx` -- クイズ/診断一覧
- `src/app/quiz/page.module.css`
- `src/app/quiz/layout.tsx` -- レイアウト

#### 個別クイズページ（動的ルート）
- `src/app/quiz/[slug]/page.tsx` -- 各クイズのメインページ（SSG、generateStaticParams）
- `src/app/quiz/[slug]/page.module.css`
- `src/app/quiz/[slug]/opengraph-image.tsx` -- クイズ自体のOGP画像

#### 結果シェア用ページ
- `src/app/quiz/[slug]/result/[resultId]/page.tsx` -- 結果ページ（OGP付きシェア用）
- `src/app/quiz/[slug]/result/[resultId]/opengraph-image.tsx` -- 結果別OGP画像

#### クイズデータ
- `src/lib/quiz/data/kanji-level.ts` -- 漢字力診断のデータ
- `src/lib/quiz/data/traditional-color.ts` -- 伝統色診断のデータ

#### テスト
- `src/lib/quiz/__tests__/scoring.test.ts`
- `src/lib/quiz/__tests__/registry.test.ts`
- `src/components/quiz/__tests__/QuizContainer.test.tsx`
- `src/app/quiz/__tests__/page.test.tsx`

#### ブログ記事
- `content/blog/quiz-diagnosis-feature.md` -- 新機能紹介記事

---

### 2. データ構造（型定義）

`src/lib/quiz/types.ts` に以下の型を定義する:

**QuizType**: 'knowledge'（知識テスト型）| 'personality'（診断型）

**QuizChoice**: 選択肢
- id: string
- text: string
- points?: Record<string, number> -- 診断型: 結果タイプへの加点マップ
- isCorrect?: boolean -- 知識型: 正解フラグ

**QuizQuestion**: 質問
- id: string
- text: string -- 質問文
- choices: QuizChoice[]
- explanation?: string -- 知識型: 解説文

**QuizResult**: 結果パターン
- id: string -- URL用ID（例: 'master', 'ai-iro'）
- title: string -- 結果タイトル（例: '漢字マスター'）
- description: string -- 結果の説明文
- color?: string -- テーマカラー（伝統色診断で使用）
- icon?: string -- アイコン絵文字
- minScore?: number -- 知識型: この結果になる最低スコア
- recommendation?: string -- おすすめコンテンツへの導線テキスト
- recommendationLink?: string -- おすすめリンク先

**QuizMeta**: クイズのメタ情報（registryで使用）
- slug: string
- title: string -- 表示名
- description: string -- 説明文
- shortDescription: string -- カード用短い説明
- type: QuizType
- questionCount: number
- icon: string
- accentColor: string
- keywords: string[]
- publishedAt: string
- relatedLinks?: Array<{ label: string; href: string }>

**QuizDefinition**: クイズの完全データ
- meta: QuizMeta
- questions: QuizQuestion[]
- results: QuizResult[]

---

### 3. コンポーネント設計

#### QuizContainer（中枢コンポーネント、use client）
- Props: quiz: QuizDefinition
- 状態: currentIndex, answers[], phase ('intro' | 'playing' | 'result')
- useReducerで状態管理（既存ゲームパターン踏襲）
- イントロ画面 -> 質問フェーズ -> 結果表示の3段階遷移
- 知識型と診断型の両方に対応（typeで分岐）

#### QuestionCard
- 1問1画面で質問を大きく表示
- 選択肢をボタンで表示、タップ/クリックで回答
- 知識型: 回答後に正解/不正解のフィードバック + 解説表示、「次へ」ボタン
- 診断型: 選択すると即座に次の質問へ遷移（テンポ重視）
- 選択時のアニメーション（CSSトランジション）

#### ProgressBar
- 現在の質問番号 / 総質問数 を表示
- 進捗バーのアニメーション

#### ResultCard
- 結果タイトル・説明を大きく表示
- テーマカラーで背景やアクセントを装飾
- スコア表示（知識型: X/Y問正解）
- おすすめコンテンツへのリンク
- ShareButtonsを内包
- 「もう一度挑戦する」ボタン

#### ShareButtons
- Web Share API（既存 src/lib/games/shared/webShare.ts を再利用）
- フォールバック: Twitter（X）シェアリンク、LINEシェアリンク
- シェアURL: /quiz/[slug]/result/[resultId] （OGP付きの結果ページ）
- シェアテキスト: 「[クイズ名]の結果は「[結果タイトル]」でした\! #yolosnet [URL]」

---

### 4. クイズデータの具体的内容

#### 4-1. 漢字力診断（kanji-level）
- 形式: knowledge型、10問4択
- 問題: 難読漢字の「読み」を4択から選ぶ。難易度順に並べる
  - Q1: 挨拶（あいさつ / あいじょう / あっとう / あくび）
  - Q2: 薔薇（ばら / しょうび / つばき / さくら）
  - Q3: 所謂（いわゆる / しょい / ところが / そのもの）
  - Q4: 流石（さすが / ながれいし / るせき / りゅうがん）
  - Q5: 海月（くらげ / うみつき / かいげつ / いるか）
  - Q6: 土竜（もぐら / どりゅう / つちへび / かめ）
  - Q7: 案山子（かかし / あんざんし / やまんば / はたけ）
  - Q8: 齧歯類（げっしるい / かじはるい / きばるい / ちいさるい）
  - Q9: 鸚鵡（おうむ / にわとり / くじゃく / うぐいす）
  - Q10: 鍼灸（しんきゅう / はりきゅう / ちんきゅう / てんきゅう）※しんきゅうが正解
- 各問に解説文を付与（漢字の由来や辞典へのリンクを含む）
- 結果パターン（5段階）:
  - 0-2問正解: 「漢字ビギナー」-- もっと漢字に触れてみよう
  - 3-4問正解: 「漢字の卵」-- 基本はバッチリ、もう少し\!
  - 5-6問正解: 「漢字中級者」-- なかなかの実力です
  - 7-8問正解: 「漢字上級者」-- かなりの漢字通\!
  - 9-10問正解: 「漢字マスター」-- 素晴らしい漢字力\!
- 関連リンク: /dictionary/kanji への誘導

#### 4-2. あなたを日本の伝統色に例えると?（traditional-color）
- 形式: personality型、8問
- 質問と選択肢（各選択肢が複数の色タイプにポイント加算）:
  - Q1: 休日の過ごし方は? (自然を楽しむ / 美術館巡り / 友人と賑やかに / 家でゆっくり)
  - Q2: 好きな季節は? (春 / 夏 / 秋 / 冬)
  - Q3: 大切にしていることは? (調和 / 情熱 / 知性 / 自由)
  - Q4: 友人からどう思われている? (穏やか / 明るい / 頼りになる / ユニーク)
  - Q5: 好きな時間帯は? (朝 / 昼 / 夕方 / 夜)
  - Q6: 旅行するなら? (森や山 / 海辺 / 歴史ある街 / 都会)
  - Q7: もらって嬉しいプレゼントは? (花 / アクセサリー / 本 / 体験チケット)
  - Q8: 座右の銘に近いのは? (和を以て貴しとなす / 一期一会 / 継続は力なり / 自分らしく)
- 結果パターン（8色）:
  - 藍色（あいいろ）#165E83 -- 知的で深みのある人
  - 朱色（しゅいろ）#BA2636 -- 情熱的でエネルギッシュな人
  - 若草色（わかくさいろ）#C3D825 -- 爽やかで生命力あふれる人
  - 藤色（ふじいろ）#BAA8CF -- 繊細で優雅な人
  - 山吹色（やまぶきいろ）#F8B500 -- 明るく社交的な人
  - 紺色（こんいろ）#1B294B -- 落ち着きのある信頼される人
  - 桜色（さくらいろ）#FEEEED -- 温かく包容力のある人
  - 翡翠色（ひすいいろ）#38B48B -- 独創的で自由な精神の持ち主
- 各結果にその色のhexコードを設定し、結果カードの背景・アクセントに使用
- 関連リンク: /colors/[slug] への誘導（該当する伝統色ページ）
- ポイント配分: 各質問の各選択肢が2-3色に1-2ポイントずつ加点。最もポイントの高い色が結果

---

### 5. OGP画像生成の方式

#### クイズ一覧ページ（/quiz/）
- 静的OGP画像。opengraph-image.tsxで「クイズ・診断」と大きく表示

#### 各クイズページ（/quiz/[slug]/）
- opengraph-image.tsx: slugに基づいてregistryからメタ情報を取得し、クイズ名とアイコンを表示
- ImageResponse APIを使用（既存パターン踏襲）

#### 結果シェア用ページ（/quiz/[slug]/result/[resultId]/）
- opengraph-image.tsx: resultIdに基づいて結果情報を取得し、結果タイトル・テーマカラーで画像生成
- 漢字力診断: 結果ランク名を大きく表示、背景色は深い青系
- 伝統色診断: 結果の色で画面全体を塗り、色名を表示。最もSNS映えするデザイン
- generateStaticParamsで全結果パターンをSSG

---

### 6. シェア機能の設計

- Web Share API: 既存の src/lib/games/shared/webShare.ts の shareGameResult と useCanWebShare を再利用
- フォールバックボタン:
  - Twitter(X): https://twitter.com/intent/tweet?text=[テキスト]&url=[URL]
  - LINE: https://social-line-me.translate.goog/R/msg/text/?[テキスト+URL]（line://msg/text/ スキーム）
  - クリップボードコピー: navigator.clipboard.writeText
- シェアURL: /quiz/[slug]/result/[resultId] にすることで、クリックした人にもOGP付きの結果表示ページが表示される
- 結果ページは、結果表示 + 「あなたも挑戦してみる?」ボタンで本体クイズへ誘導

---

### 7. SEO対策

#### メタデータ
- src/lib/seo.ts に generateQuizMetadata と generateQuizJsonLd を追加
- 各ページにtitle, description, keywords, openGraph, canonical を設定

#### 構造化データ（JSON-LD）
- クイズページ: schema.org/Quiz タイプ（比較的新しいが検索エンジンが認識）
- フォールバックとして WebApplication タイプも検討
- パンくずリスト: 既存の generateBreadcrumbJsonLd を使用

#### サイトマップ
- src/app/sitemap.ts に /quiz/, /quiz/[slug]/, /quiz/[slug]/result/[resultId]/ を追加

---

### 8. トップページ・ナビゲーション更新

#### Header.tsx
- NAV_LINKS に { href: '/quiz', label: 'クイズ' } を追加（'ゲーム'の後に配置）

#### page.tsx（トップページ）
- STAT_BADGES に「クイズ・診断」を追加
- デイリーパズルセクションと人気ツールセクションの間に「クイズ・診断」セクションを新設
- クイズカード2枚を横並びで表示（registryからデータ取得）
- 「全クイズを見る」リンク

---

### 9. テスト計画

- scoring.test.ts: 知識型スコア計算、診断型ポイント集計、境界値テスト
- registry.test.ts: 全クイズデータの整合性チェック（必須フィールド、結果パターンの存在確認）
- QuizContainer.test.tsx: 初期表示、質問遷移、回答記録、結果表示への遷移
- page.test.tsx: 一覧ページのレンダリング、各クイズカードの表示

---

### 10. 実装の順序（依存関係を考慮）

実装は3つのビルダータスクに分割する。

#### タスク1: クイズ基盤 + 漢字力診断（builder-1）
依存なし。最初に着手。

1. src/lib/quiz/types.ts を作成
2. src/lib/quiz/scoring.ts を作成
3. src/lib/quiz/data/kanji-level.ts を作成
4. src/lib/quiz/registry.ts を作成
5. src/components/quiz/ の全共通コンポーネントを作成
6. src/app/quiz/[slug]/page.tsx を作成
7. src/app/quiz/[slug]/opengraph-image.tsx を作成
8. src/app/quiz/[slug]/result/[resultId]/page.tsx を作成
9. src/app/quiz/[slug]/result/[resultId]/opengraph-image.tsx を作成
10. src/lib/seo.ts にクイズ用のメタデータ生成関数を追加
11. テスト作成

#### タスク2: 伝統色診断データ + 一覧ページ + 導線（builder-2）
タスク1の完了後に着手（共通コンポーネントとregistryに依存）。

1. src/lib/quiz/data/traditional-color.ts を作成
2. registry.ts に伝統色診断を追加
3. src/app/quiz/page.tsx（一覧ページ）を作成
4. src/app/quiz/layout.tsx を作成
5. Header.tsx にクイズリンクを追加
6. page.tsx（トップページ）にクイズセクションを追加
7. src/app/sitemap.ts にクイズページを追加

#### タスク3: ブログ記事（builder-3）
タスク1, 2の完了後に着手。

1. content/blog/quiz-diagnosis-feature.md を作成
2. クイズ機能の紹介、設計判断の背景、今後の展開を記述

---

### 備考

- 既存の並行ビルダーの問題（pre-commit hookの競合）に注意。タスク1とタスク2は順次実行を推奨
- /quiz/[slug]/result/[resultId]/ のルート構造により、結果シェアURLがOGP画像付きで機能する
- 将来的にクイズ数が増えた際はカテゴリ分け（knowledge/personality）を一覧ページに追加可能
- 伝統色診断の色データは既存の /colors/ データ（src/data/traditional-colors.json）と整合性を保つこと
