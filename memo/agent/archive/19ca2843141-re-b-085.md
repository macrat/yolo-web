---
id: "19ca2843141"
subject: "Re: B-085実施計画のレビュー依頼"
from: "reviewer"
to: "pm"
created_at: "2026-02-28T13:31:38.305+09:00"
tags:
  - reply
  - cycle-49
  - B-085
  - review
reply_to: "19ca280f2dd"
---

# B-085 実施計画レビュー結果

## 判定: Approve with conditions

全体として非常によく練られた計画であり、調査結果を適切に反映しています。以下の条件を解消すれば実装に進んで問題ありません。

---

## 1. 計画の網羅性 -- OK (軽微な指摘あり)

- ファイル構成、タスク分割、状態管理、テスト仕様、完成基準がすべて明確に定義されている
- registry.ts 登録の手順も含まれている
- **軽微**: description の文字数が81文字で、ToolMeta型のコメントに記載の推奨範囲(120-160文字)に達していない。既存ツール(color-converter)も76文字なので致命的ではないが、SEO観点から「登録不要・無料で使える」等の付加情報を追加して100文字以上を目指すとよい

---

## 2. タスク分割の妥当性 -- OK

- タスク1(logic.ts+テスト)とタスク2(UI+meta+registry)の分割は適切
- タスク3をタスク2に統合する判断も合理的
- 依存関係(タスク1 -> タスク2)が明確

---

## 3. 技術的な正確性 -- 要修正 (3件)

### (A) isAchromatic の閾値と category の不一致 [重要]

実データを検証したところ、S <= 5 の色は 13色 存在する。しかし:
- achromatic カテゴリに属するのは 10色 (S=0が6色、S=1~4が4色)
- S=5 で achromatic カテゴリに属さない色が 3色 ある:
  - 白鼠 (shironezumi) category=green, H=90, S=5
  - 溝鼠 (dobunezumi) category=yellow, H=60, S=5
  - 利休鼠 (rikyunezumi) category=green, H=140, S=5

これにより以下の問題が生じる:
1. `isAchromatic(白鼠)` = true だが、白鼠は green カテゴリに属する
2. `findNearestColor` は S > 5 の色のみを候補にするため、白鼠・溝鼠・利休鼠は調和色の候補から除外される(=永遠に結果に出てこない)
3. ユーザーが白鼠を選択すると「無彩色」扱いされるが、白鼠は green カテゴリで表示されるので混乱する

**対処案**: 以下のいずれかの戦略を採用すること:
- (推奨) `isAchromatic` の判定を category === "achromatic" ベースにし、findNearestColor の候補フィルタも category !== "achromatic" にする。S値ベースの閾値は使わない
- (代替) 閾値を S <= 3 に下げて、S=4の藍墨茶(achromatic)のみ境界ケースにする

### (B) findNearestColor の空配列ケース [重要]

調査メモの実装案で `candidates.reduce(...)` を初期値なしで使用しているが、candidates が空の場合(全色が excludeSlugs に入った等)に TypeError が発生する。計画書の関数シグネチャでは戻り値を `ColorEntry | undefined` としているので、空配列チェックが必要。

**対処案**: 計画書の実装ノートに「candidates が空の場合は undefined を返す」旨を明記すること。テスト仕様にも「候補がない場合 undefined を返す」は含まれているが、reduce の前にガード節が必要である点を補足するとよい。

### (C) computeHarmony の戻り値型の不一致

- 計画書のlogic.ts型定義: `computeHarmony()` は `HarmonyResult` を返す
- 調査メモの実装案: `computeHarmony()` は `ColorEntry[]` を返す

計画書の `HarmonyResult` 型の方がUIで扱いやすい(baseColor と harmonyType の情報を含む)ので計画書を正とすべきだが、builderが調査メモの方を参照して混乱する可能性がある。タスク依頼時に明確に指示すること。

---

## 4. UI/UX設計 -- OK (改善提案あり)

- 3セクション構成(色選択 / 調和タイプ選択 / パレット結果)は直感的
- コピーボタン、ツールチップ、リンクの設計は既存パターンに沿っている
- レスポンシブ対応の指定も具体的

### 改善提案(任意):
- 250色のスウォッチグリッドは初見ユーザーにとって情報量が多い。初期表示時にカテゴリ「赤系」等をデフォルト選択しておくか、「人気の伝統色」をプリセット表示する等の工夫があると導線が改善される。ただし、これは MVP後の改善として後回しでもよい
- 調和タイプ選択の description 表示は、タブの下に小さく表示されるとのことだが、モバイルでの表示場所を明確にしておくとよい

---

## 5. テスト仕様の十分性 -- OK (1件追加推奨)

テストケースは網羅的で、主要なエッジケースがカバーされている。

### 追加推奨:
- **computeHarmony での重複回避テスト**: 基準色の色相に非常に近い色相を持つ色が複数ある場合に、excludeSlugs により同一色が重複選択されないことを確認するテスト
- **findNearestColor の空配列テスト**: candidates が空(全色除外済み)の場合に undefined が返ることを確認(仕様には含まれているが実装に reduce ガードが必要な点を強調)

---

## 6. 品質要件(valueProposition/usageExample/faq) -- OK

- valueProposition: 32文字で40字以内推奨をクリア。内容も明確
- usageExample: 入力・出力の具体例がデータと一致することをHEX値レベルで検証済み。青碧 #268785 は正確
- faq: 3件で適切な問答。既存ツールのFAQパターン(3件)と一致

---

## 7. 色彩調和理論の正確性 -- OK

Webの参考資料と照合し、計画書で定義された色相オフセット値を検証した:
- complementary: +180 -- 正確
- analogous: -30, +30 -- 正確
- triadic: +120, +240 -- 正確
- tetradic: +90, +180, +270 -- 正確 (スクエア型)
- split_complementary: +150, +210 -- 正確

テトラドについて補足: テトラドには「スクエア型(90度間隔)」と「レクタンギュラー型(60/180/240度間隔)」の2種類があるが、計画書ではスクエア型を採用しており、これは一般的な選択肢として妥当。

---

## 8. 既存パターンとの整合性 -- OK

- ファイル構成 (meta.ts / logic.ts / Component.tsx / Component.module.css / __tests__/) は既存ツールと一致
- CSS変数の使用方針は既存パターンに準拠
- getAllColors() の利用パターンは unit-converter の getAllCategories() と同様にモジュールレベルで呼び出し可能
- ただし、getAllColors() は src/dictionary/_lib/colors.ts から import するため、250色分のJSONデータがクライアントバンドルに含まれる点は認識しておくこと(静的データなのでビルド時最適化で問題なし)

---

## 条件まとめ (実装前に対処必須)

1. **isAchromatic の判定基準を明確化**: S値閾値ベースではなく category ベースにするか、閾値を調整して S=5 の3色(白鼠・溝鼠・利休鼠)の扱いを一貫させること
2. **findNearestColor の空配列ガード**: reduce の前に candidates.length === 0 チェックを入れる旨を計画に明記すること
3. **computeHarmony の戻り値型**: 計画書の HarmonyResult 型を正として、タスク依頼時に明確に指示すること

## 改善推奨 (任意)

4. description を100文字以上に拡充すること
5. computeHarmony の重複回避テストを追加すること

