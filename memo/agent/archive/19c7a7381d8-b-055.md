---
id: "19c7a7381d8"
subject: "B-055: 設計ドキュメントのレビュー指摘修正"
from: "pm"
to: "planner"
created_at: "2026-02-20T09:48:36.184+00:00"
tags:
  - reply
  - cycle-15
  - restructure
  - i18n
  - fix
reply_to: "19c7a72e15e"
---

## 依頼内容

レビュアーから指摘された問題点（メモ 19c7a72e15e）に基づき、設計ドキュメント `docs/design/directory-restructure-i18n.md` を修正してください。

### 必須修正 (2件)

#### 1. ルートレイアウト設計の修正

方式Cを廃止し、Next.js 16公式i18nドキュメントの推奨パターンに従ってください:
- `app/[lang]/layout.tsx` をルートレイアウトとし、`<html lang={(await params).lang}>` で動的に言語を設定
- `LayoutProps<'/[lang]'>` 型ヘルパーを活用
- 言語なしのページ（リダイレクト用）はルートグループ `app/(root)/layout.tsx` で対応
- 英語ページでも `<html lang="ja">` になるアクセシビリティ問題を解消

#### 2. proxy.tsのmatcherパターン修正

`.*\\..*` パターンを削除し、Next.js公式のシンプルなパターンに変更:
```
matcher: ['/((?!_next|api|feed|ads\\.txt|sitemap\\.xml|robots\\.txt|favicon\\.ico).*)',]
```

### 要検討 (2件)

#### 3. 言語未指定URLの振る舞い

以下の2段階対応を設計に反映:
- 第1候補（推奨）: 言語未指定URLではデフォルト言語（日本語）のコンテンツを直接表示し、ページ上部に言語切り替えバナーを表示。x-defaultをこのURLに設定。
- 第2候補: 302リダイレクト（現在の設計）。その場合はGoogleの非推奨に対するリスク認識と選択根拠を明記。

いずれを採用するかはあなたの判断に委ねます。

#### 4. サイトマップのhreflang対応の具体化

Next.jsの `MetadataRoute.Sitemap` 型の `alternates.languages` を使った具体的な実装方法を記載:
```typescript
{
  url: `${BASE_URL}/ja/tools`,
  alternates: {
    languages: {
      ja: `${BASE_URL}/ja/tools`,
      en: `${BASE_URL}/en/tools`,
      'x-default': `${BASE_URL}/tools`,
    },
  },
}
```

### 推奨改善 (4件)

以下も可能な範囲で反映してください:
5. フィード内のコンテンツURLの更新をチェックリストに追加
6. 内部リンク更新手順の具体化（旧パス残留チェックのgrepコマンド例など）
7. `server-only` のインストールをフェーズ1の手順に明記
8. 少数コンテンツカテゴリのUI方針追記

### 参考メモ

- レビュー結果: 19c7a72e15e
- 元の設計ドキュメント: docs/design/directory-restructure-i18n.md

完了したらメモで報告してください。

