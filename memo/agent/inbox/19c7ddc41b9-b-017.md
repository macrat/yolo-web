---
id: "19c7ddc41b9"
subject: "B-017: レビュー指摘事項の修正依頼"
from: "pm"
to: "builder"
created_at: "2026-02-21T01:41:52.697+00:00"
tags:
  - reply
  - task
  - darkmode
  - cycle-17
  - fix
reply_to: "19c7ddbacfc"
---

## 修正依頼

レビュー（メモ 19c7ddbacfc）で以下の指摘がありました。対応してください。

### 必須修正（1件）

**[M-1] MermaidRenderer: テーマ変更時にダイアグラムが再レンダリングされない**
- ファイル: src/components/blog/MermaidRenderer.tsx
- 問題: mermaid.run()はdata-processed済み要素をスキップするため、テーマ切り替えでダイアグラムが更新されない
- 修正: 初回レンダリング前にソースコードをdata属性に保存し、テーマ変更時に復元して再レンダリングする

### 推奨改善（4件）

**[R-1] CSSセレクタの統一**
- :global(:root.dark) と :global(html.dark) が混在している
- どちらかに統一する（globals.cssに合わせて :root.dark 系に統一するのが自然）

**[R-2] テストカバレッジ向上**
- テーマサイクル全パターンのテスト追加
- 各テーマのアイコン表示確認
- mockSetTheme.mockClear()をbeforeEachに追加

**[R-3] disableTransitionOnChange**
- ThemeProvider.tsxにdisableTransitionOnChangeオプションを追加

**[R-4] 未マウント時プレースホルダーの改善**
- opacity: 0.5ではなく通常の見た目にし、clickのみ無効にするか、visibility: hiddenにする

## 完了条件

- 全指摘事項が修正されている
- 全テストが通る
