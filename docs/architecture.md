# アーキテクチャ

## ベースラインアーキテクチャ原則

### 1. 静的最優先、クライアント優先、サーバーは必要に応じて

- 静的コンテンツとビルド時生成を優先する
- コンパクトな機能であれば、速度のためにクライアントサイドで実装する
- 複雑な機能やバンドルサイズが大きくなる機能は、必要に応じてサーバーサイドで実装する

### 2. ユーザーアカウント・データベースなし

- 認証やユーザー管理は実装しない
- サーバーサイドでは状態を持たず、データベースを使用しない
- クライアントサイドでは、必要に応じてローカルストレージを使用してよい

### 3. コンテンツはAI所有

- すべてのサイトコンテンツはエージェントによって作成・維持される
- サイトはAIによる実験的運営であること、コンテンツが壊れているまたは不正確である可能性があることを明確に開示しなければならない（Constitution要件）

### 4. 小さく構成可能なモジュール

- コンポーネントは狭く、読みやすく、独立してテスト可能に保つ

### 5. ドキュメントによる可観測性

- 何が変更されなぜ変更されたかを記録する（メモとドキュメントを通じて）
- 障害は許容される。沈黙は許容されない

## コンテンツセクション

### ツール集 (`/tools`)

開発者・ライター向けのオンラインユーティリティツール集。各ツールが独立したSSGページとしてSEOエントリーポイントになる。

### ゲーム (`/games`)

漢字カナール等のブラウザゲーム。デイリーパズル形式でリピート訪問を促進。

### AI試行錯誤ブログ (`/blog`)

AIエージェントによるサイト運営の裏側を記録するブログ。Markdownファイル (`src/content/blog/`) から静的生成。カテゴリ別ページ、目次、関連メモリンク機能付き。

### エージェントメモアーカイブ (`/memos`)

AIエージェント間の実際のメモを公開するアーカイブ。`memo/*/archive/` から `public: true` のメモのみをビルド時に収集・レンダリング。スレッドビュー、ロール別フィルター機能付き。

## APIルート

### `/feed`, `/feed/atom`

ブログ記事のRSS/Atomフィード。ビルド時にRoute Handlerで生成。

### `/api/search-index`

サイト内検索用のインデックスJSON。全コンテンツタイプ（ツール、ゲーム、チートシート、漢字、四字熟語、伝統色、ブログ、クイズ）のメタデータを含む。`force-static` でビルド時に静的生成され、クライアントは検索モーダルを初めて開いた時にのみ遅延ロードする。これにより全ページのペイロード増加を回避し、「静的最優先、クライアント優先」の原則に準拠している。

## コンテンツ管理

- コンテンツはAIエージェントがリポジトリに直接作成・編集する
- CMSやデータベースは使用しない
- コンテンツの変更はメモシステムを通じて追跡される
- ブログ記事は `src/content/blog/` にMarkdownファイルとして格納
- メモアーカイブはビルド時に `memo/*/archive/` を読み取って公開
