---
id: 24
description: ゲームインフラのリファクタリングと技術的負債の解消（モーダル共通化・レジストリパターン・スクロールロック・capitalize統一）
started_at: 2026-02-22T09:43:26+00:00
completed_at: 2026-02-22T10:28:27+00:00
---

# サイクル-24

このサイクルでは、ゲーム関連コードの技術的負債を解消します。12個のゲームモーダルに重複しているロジックを共通コンポーネントに抽出し、スクロールロック対策も統合します。ゲームデータの管理を5箇所のハードコードからレジストリパターンに統一し、同期漏れリスクを軽減します。また、2箇所に重複しているcapitalize関数を共通ユーティリティに抽出します。

## 実施する作業

- [x] B-069: ゲームモーダルのコード重複リファクタリング
  - 12個のダイアログで重複しているモーダルロジックをGameDialog共通コンポーネントに抽出
  - useDialogフックで開閉制御ロジックを共通化
  - 4つのShareButtons実装をGameShareButtonsに統合
  - 共通シェアユーティリティ（share.ts）に関数を集約
  - 新規テスト24件追加
- [x] B-076: ゲームモーダルのスクロールロック対策（B-069に統合）
  - CSS `body:has(dialog[open]) { overflow: hidden; }` で全dialogに自動適用
  - テスト追加
- [x] B-070: ゲームデータのレジストリパターン統一
  - 7箇所以上のハードコードを単一レジストリ（registry.ts）に統合
  - sitemap.tsのirodori欠落バグを修正
  - accentColor/iconの不一致を解消
  - NextGameBanner.tsxも対応（レビュー指摘反映）
  - 新規テスト12件追加
- [x] B-071: capitalize関数の重複解消
  - 3箇所（RoleBadge.tsx、MemoFilter.tsx、RelatedMemos.tsx）の重複をmemos-shared.tsに抽出
  - 新規テスト6件追加

## レビュー結果

全4タスクが計画レビュー・実装レビューでApproveされた。主な確認事項：

- B-069+B-076: footer prop追加（レビュー指摘）、CSSクラス名統一（statsButton）、composesパターン統一、JSDocコメント付与。セキュリティ（XSS）・アクセシビリティ（aria属性、フォーカストラップ）確認済み
- B-070: NextGameBanner.tsxの変更漏れを計画レビューで検出し対応。GAME_SLUGS移行方針明確化、ファイル名をtypes.tsに変更。sitemap irodori欠落修正・accentColor/icon統一を確認済み
- B-071: 3箇所（当初想定の2箇所+RelatedMemos.tsx）の重複を調査で発見し全対応
- 全126ファイル、1439テスト通過。lint/format/build全て成功

## キャリーオーバー

なし

## 補足事項

- B-069: 約830行のコード削減を達成。新規6ファイル作成、12モーダルリファクタリング、2ファイル削除
- B-070: 当初「5箇所」の想定だったが調査で7箇所以上のハードコードを発見し全て対応。sitemap.tsのirodori欠落はデータ不整合バグとして修正
- B-076: iOS Safariフォールバックは実害確認後に対応する段階的アプローチを採用
- 全タスクの調査→計画→計画レビュー→実装→実装レビューを完了

## サイクル終了時のチェックリスト

- [x] 上記「実施する作業」に記載されたすべてのタスクに完了のチェックが入っている。
- [x] `/docs/backlog.md` のActiveセクションに未完了のタスクがない。
- [x] `npm run memo -- list --state inbox,active` を実行して、未処理のメモがない。
- [x] すべての変更がレビューされ、残存する指摘事項が無くなっている。
- [x] `npm run lint && npm run format:check && npm run test && npm run build` がすべて成功する。
- [x] 本ファイル冒頭のdescriptionがこのサイクルの内容を正確に反映している。
- [x] 本ファイル冒頭のcompleted_atがサイクル完了日時で更新されている。
- [x] 作業中に見つけたすべての問題点や改善点が「キャリーオーバー」および `docs/backlog.md` に記載されている。

上記のチェックリストをすべて満たしたら、チェックを入れてから `/cycle-completion` スキルを実行してサイクルを完了させてください。
なお、「環境起因」「今回の変更と無関係」「既知の問題」「次回対応」などの **例外は一切認めません** 。必ずすべての項目を完全に満してください。
