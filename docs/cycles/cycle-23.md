---
id: 23
description: 検索機能UX改善（マッチハイライト・モバイル戻るボタン・aria-expanded）とブログ目次バグ修正
started_at: 2026-02-21T13:37:42+00:00
completed_at: 2026-02-21T15:55:00+00:00
---

# サイクル-23

このサイクルでは、サイクル20で構築した検索機能のUXを改善し、サイクル21で発見されたブログ目次のバグを修正します。検索結果のマッチ部分ハイライト、モバイルでの戻るボタン対応、アクセシビリティ改善の3つの検索改善と、目次生成のインラインリンク記法対応を行います。

## 実施する作業

- [x] B-073: 検索結果のマッチ部分ハイライト
  - Fuse.jsのmatches情報を使って検索結果のマッチ部分を視覚的にハイライトする
  - ハイライト表示用のコンポーネントまたはユーティリティを作成
  - テストを追加
- [x] B-074: モバイル戻るボタンで検索モーダル閉じ
  - history APIを使ってモバイルの戻るボタンで検索モーダルを閉じられるようにする
  - pushState/popStateイベントを活用
  - テストを追加
- [x] B-072: 検索モーダルのaria-expanded動的切り替え
  - 検索トリガーボタンのaria-expanded属性を開閉状態に連動させる
  - テストを追加
- [x] B-077: extractHeadingsのインラインリンク記法strip
  - 目次生成のextractHeadingsでMarkdownインラインリンク記法をstrip処理する
  - テストを追加

## レビュー結果

全4タスクがレビューでApproveされた。主な確認事項：

- B-073: ダークモードCSS記法を`:global(:root.dark)`パターンに統一（実装で対応済み）
- B-072/B-074: SearchTrigger.test.tsxの新規作成がB-072→B-074の順序で実施（競合なし）
- B-077: 画像記法stripを`![alt](url)->""` に変更（markdownToHtmlとのID一貫性のため）
- セキュリティ（XSS）、パフォーマンス、アクセシビリティの各観点で問題なし

## キャリーオーバー

なし

## 補足事項

- 全120テストファイル、1396テスト通過
- B-077では計画からの合理的な差分あり（画像alt textの扱い）。markdownToHtml側の実動作に合わせた

## サイクル終了時のチェックリスト

- [x] 上記「実施する作業」に記載されたすべてのタスクに完了のチェックが入っている。
- [x] `/docs/backlog.md` のActiveセクションに未完了のタスクがない。
- [x] `npm run memo -- list --state inbox,active` を実行して、未処理のメモがない。
- [x] すべての変更がレビューされ、残存する指摘事項が無くなっている。
- [x] `npm run lint && npm run format:check && npm run test && npm run build` がすべて成功する。
- [x] 本ファイル冒頭のdescriptionがこのサイクルの内容を正確に反映している。
- [x] 本ファイル冒頭のcompleted_atがサイクル完了日時で更新されている。
- [x] 作業中に見つけたすべての問題点や改善点が「キャリーオーバー」および `docs/backlog.md` に記載されている。

上記のチェックリストをすべて満たしたら、チェックを入れてから `/cycle-completion` スキルを実行してサイクルを完了させてください。
なお、「環境起因」「今回の変更と無関係」「既知の問題」「次回対応」などの **例外は一切認めません** 。必ずすべての項目を完全に満してください。
